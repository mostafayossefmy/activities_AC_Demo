<!DOCTYPE html>
<html lang="ar">

<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ - Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --display-box-width: 460px;
      --display-box-height: 120px;
      --letter-size: 55px;
      --main-font-family: 'NotoSansArabic_Condensed-Bold', Arial, sans-serif;
    }

    @font-face {
      font-family: 'NotoSansArabic_Condensed-Bold';
      src: url('fonts/NotoSansArabic_Condensed-Bold.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    body {
      margin: 0;
      padding: 0;
      background: url('images/back_a_img.png') no-repeat center center;
      background-size: cover;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--main-font-family);
      direction: rtl;
    }

    .activity-container {
      width: 100%;
      max-width: 1000px;
      height: 80vh;
      max-height: 800px;
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      display: flex;
      overflow: visible;
    }

    .sidebar {
      width: 15%;
      background: #f3e8ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      padding: 15px 10px;
      border-top-right-radius: 15px;
      border-bottom-right-radius: 15px;
    }

    .row {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .stars img {
      width: 30px;
      height: 30px;
      transition: transform .25s ease, filter .25s ease;
    }

    .child-photo img {
      width: 110px;
      height: 110px;
      display: block;
      margin: 0 auto;
      object-fit: cover;
    }

    .student-name p {
      margin: 0;
      font-size: 16px;
      font-weight: bold;
      background: #fff1cc;
      border-radius: 12px;
      padding: 6px 12px;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: center;
    }

    .timer-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .timer-controls img {
      width: 40px;
      height: 40px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .timer-controls img:hover {
      transform: scale(1.1);
    }

    .timer-display {
      font-size: 20px;
      font-weight: bold;
      background: #f779e2;
      border-radius: 8px;
      padding: 5px 10px;
      min-width: 50px;
      height: 35px;
      text-align: center;
      line-height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 25px;
      width: 100%;
      margin-top: 20px !important;
    }

    .controls img {
      width: 55px;
      height: 55px;
      cursor: pointer;
      transition: transform .15s ease;
    }

    .controls img:hover {
      transform: scale(1.08);
    }

    .activity-content {
      width: 85%;
      padding: 18px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      position: relative;
    }

    .activity-label {
      position: absolute;
      top: -25px;
      left: -25px;
      width: 150px;
      z-index: 5;
    }

    .instructions-icon {
      position: absolute;
      top: 35px;
      left: 25px;
      width: 70px;
      height: 70px;
      cursor: pointer;
      z-index: 15;
      transition: transform 0.2s ease, filter 0.2s ease;
    }

    .instructions-icon:hover {
      transform: scale(1.1);
      filter: drop-shadow(0 0 5px #f779e2);
    }

    .word-display {
      font-size: 48px;
      font-weight: bold;
      color: #333;
      margin-top: 10px;
    }

    .analysis-area {
      width: var(--display-box-width);
      height: var(--display-box-height);
      background: #ffffcc;
      border: 10px solid #ff9966;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: bold;
      color: #0015fc;
      flex-wrap: wrap;
      transition: box-shadow 0.3s ease;
      letter-spacing: 5px;
    }

    .analysis-area.correct-letter {
      box-shadow: 0 0 15px 6px yellow;
    }

    .glowing-box {
      animation: correctGlow 0.8s ease-in-out 2;
    }

    @keyframes correctGlow {
      0% { box-shadow: 0 0 0 #4CAF50; }
      50% { box-shadow: 0 0 25px 8px #4CAF50; }
      100% { box-shadow: 0 0 0 #4CAF50; }
    }

    .letters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      max-width: 635px;
      margin-top: 10px;
      direction: rtl;
    }

    .letter {
      width: 50px;
      height: 50px;
      background: url('images/back_letter.png') no-repeat center center;
      background-size: cover;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: transform .15s ease;
    }

    .letter:active {
      transform: scale(1.05);
      cursor: grabbing;
    }

    /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙÙŠ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ */
    .demo-end-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 200;
    }

    .demo-end-popup.show {
      visibility: visible;
      opacity: 1;
    }

    .demo-end-content {
      background: white;
      padding: 40px;
      border-radius: 30px;
      text-align: center;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      animation: popIn 0.6s ease;
    }

    .demo-end-content h2 {
      font-size: 2.5rem;
      color: #1dd1a1;
      margin-bottom: 20px;
    }

    .demo-end-content p {
      font-size: 1.8rem;
      color: #333;
      margin: 20px 0;
    }

    .demo-end-content .close-btn {
      background: #ff6b6b;
      color: white;
      padding: 15px 50px;
      border-radius: 50px;
      font-size: 1.6rem;
      cursor: pointer;
      margin-top: 30px;
      display: inline-block;
    }

    .demo-end-content .close-btn:hover {
      background: #ee5a24;
    }

    @keyframes popIn {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>

<body>
  <div class="activity-container">
    <div class="sidebar">
      <div class="row stars">
        <img id="star1" src="images/star1.png" alt="Ù†Ø¬Ù…Ø©1">
        <img id="star2" src="images/star2.png" alt="Ù†Ø¬Ù…Ø©2">
        <img id="star3" src="images/star3.png" alt="Ù†Ø¬Ù…Ø©3">
      </div>
      <div class="row child-photo">
        <img src="images/child_photo.png" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„" id="userPhoto">
      </div>
      <div class="row student-name">
        <p id="userNameDisplay">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</p>
      </div>
      <div class="row timer">
        <div class="timer-controls">
          <img src="images/play.png" alt="Play" id="playBtn">
          <div class="timer-display" id="timer">0</div>
          <img src="images/stop.png" alt="Stop" id="stopBtn">
        </div>
      </div>
      <div class="row controls">
        <img id="homeBtn" src="images/home.png" alt="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
        <img id="retryBtn" src="images/retry.png" alt="Ø¥Ø¹Ø§Ø¯Ø©">
      </div>
    </div>

    <div class="activity-content">
      <img src="images/sd_img.png" alt="ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·" class="instructions-icon">
      <img class="activity-label" src="images/actv_3.png" alt="Ù„ÙˆØ¬Ùˆ Ø§Ù„Ù†Ø´Ø§Ø·">
      <div id="wordDisplay" class="word-display"></div>
      <div id="analysisArea" class="analysis-area"></div>
      <div class="letters" id="lettersGrid"></div>
    </div>
  </div>

  <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© -->
  <div class="demo-end-popup" id="demoEndPopup">
    <div class="demo-end-content">
      <h2>Ù‡Ø§ÙŠÙ„ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‘</h2>
      <p>Ù…Ù…ÙƒÙ† ØªØ´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† Ø¹Ø´Ø§Ù† ØªÙƒÙ…Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§ØªØŸ</p>
      <p>Ø´ÙƒØ±Ø§ Ù„Ùƒ Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©</p>
      <div class="close-btn" onclick="window.location.href='activities_demo.html'">Ø­Ø³Ù†Ù‹Ø§</div>
    </div>
  </div>

  <script>
    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„
    const storedName = sessionStorage.getItem('userName');
    const storedPhoto = sessionStorage.getItem('userImage');
    if (storedName) document.getElementById('userNameDisplay').textContent = storedName;
    if (storedPhoto) document.getElementById('userPhoto').src = storedPhoto;

    // Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
    const levelsWords = {
      1: [
        { word: "Ø£Ø³Ø¯", letters: ['Ø£', 'Ø³', 'Ø¯'], shaped: ['Ø£', 'Ø³Ù€', 'Ø¯'],soundIndex: 1 },
        { word: "Ø¬Ø²Ø±", letters: ['Ø¬', 'Ø²', 'Ø±'], shaped: ['Ø¬Ù€', 'Ø²', 'Ø±'],soundIndex: 2 },
        { word: "ÙˆÙ„Ø¯", letters: ['Ùˆ', 'Ù„', 'Ø¯'], shaped: ['Ùˆ', 'Ù„Ù€', 'Ø¯'],soundIndex: 3 },
        { word: "Ø¨Ù†Øª", letters: ['Ø¨', 'Ù†', 'Øª'], shaped: ['Ø¨Ù€', 'Ù†Ù€', 'Øª'],soundIndex: 4 },
        { word: "Ø¹Ù†Ø¨", letters: ['Ø¹', 'Ù†', 'Ø¨'], shaped: ['Ø¹Ù€', 'Ù†Ù€', 'Ø¨'],soundIndex: 5 },
        { word: "Ø¬Ù…Ù„", letters: ['Ø¬', 'Ù…', 'Ù„'], shaped: ['Ø¬Ù€', 'Ù…Ù€', 'Ù„'],soundIndex: 6 },
        { word: "Ø²Ø±Ø¹", letters: ['Ø²', 'Ø±', 'Ø¹'], shaped: ['Ø²', 'Ø±', 'Ø¹'],soundIndex: 7 },
        { word: "Ø³ÙˆÙ‚", letters: ['Ø³', 'Ùˆ', 'Ù‚'], shaped: ['Ø³Ù€', 'Ùˆ', 'Ù‚'],soundIndex: 8 },
        { word: "Ø·ÙÙ„", letters: ['Ø·', 'Ù', 'Ù„'], shaped: ['Ø·Ù€', 'ÙÙ€', 'Ù„'],soundIndex: 9 },
        { word: "ÙÙŠÙ„", letters: ['Ù', 'ÙŠ', 'Ù„'], shaped: ['ÙÙ€', 'ÙŠÙ€', 'Ù„'],soundIndex: 10 }
      ],
      2: [
        { word: "Ù‚Ù„Ù…", letters: ['Ù‚', 'Ù„', 'Ù…'], shaped: ['Ù‚Ù€', 'Ù„Ù€', 'Ù…'],soundIndex: 11 },
        { word: "Ù‚Ù…Ø±", letters: ['Ù‚', 'Ù…', 'Ø±'], shaped: ['Ù‚Ù€', 'Ù…Ù€', 'Ø±'],soundIndex: 12 },
        { word: "ÙˆØ±Ù‚", letters: ['Ùˆ', 'Ø±', 'Ù‚'], shaped: ['Ùˆ', 'Ø±', 'Ù‚'],soundIndex: 13 },
        { word: "Ù…Ø±ÙƒØ¨", letters: ['Ù…', 'Ø±','Ùƒ','Ø¨'], shaped: ['Ù…Ù€', 'Ø±', 'ÙƒÙ€', 'Ø¨'],soundIndex: 14 },
        { word: "Ù…ØªØ±Ùˆ", letters:['Ù…', 'Øª', 'Ø±', 'Ùˆ'], shaped: ['Ù…Ù€', 'ØªÙ€', 'Ø±', 'Ùˆ'],soundIndex: 15 },
        { word: "Ø¨Ø·Ø©", letters: ['Ø¨', 'Ø·', 'Ø©'], shaped: ['Ø¨Ù€', 'Ø·Ù€', 'Ù€Ø©'],soundIndex: 16 },
        { word: "Ø¯Ø¨", letters: ['Ø¯', 'Ø¨'], shaped: ['Ø¯', 'Ø¨'],soundIndex: 17 },
        { word: "Ø´Ù…Ø³", letters: ['Ø´', 'Ù…', 'Ø³'], shaped: ['Ø´Ù€', 'Ù…Ù€', 'Ø³'],soundIndex: 18 },
        { word: "Ù‚Ø·Ø©", letters: ['Ù‚', 'Ø·', 'Ø©'], shaped: ['Ù‚Ù€', 'Ø·Ù€', 'Ù€Ø©'],soundIndex: 19 },
        { word: "Ø®Ø³", letters: ['Ø®', 'Ø³'], shaped: ['Ø®Ù€', 'Ø³'],soundIndex: 20 }
      ],
      3: [
        { word: "Ø³Ù…ÙƒØ©", letters: ['Ø³', 'Ù…', 'Ùƒ', 'Ø©'], shaped: ['Ø³Ù€', 'Ù…Ù€', 'ÙƒÙ€', 'Ù€Ø©'],soundIndex: 21 },
        { word: "ÙƒØ±Ø³ÙŠ", letters: ['Ùƒ', 'Ø±', 'Ø³', 'ÙŠ'], shaped: ['ÙƒÙ€', 'Ø±', 'Ø³Ù€', 'ÙŠ'],soundIndex: 22 },
        { word: "Ø´ÙˆØ±Øª", letters: ['Ø´', 'Ùˆ', 'Ø±', 'Øª'], shaped: ['Ø´Ù€', 'Ùˆ', 'Ø±', 'Øª'],soundIndex: 23 },
        { word: "Ø®Ø±ÙˆÙ", letters: ['Ø®', 'Ø±', 'Ùˆ', 'Ù'], shaped: ['Ø®Ù€', 'Ø±', 'Ùˆ', 'Ù'],soundIndex: 24 },
        { word: "Ø£Ø±Ù†Ø¨", letters: ['Ø£', 'Ø±', 'Ù†', 'Ø¨'], shaped: ['Ø£', 'Ø±', 'Ù†Ù€', 'Ø¨'],soundIndex: 25 },
        { word: "Ø¨Ø­Ø±", letters: ['Ø¨', 'Ø­', 'Ø±'], shaped: ['Ø¨Ù€', 'Ø­Ù€', 'Ø±'],soundIndex: 26 },
        { word: "ÙˆØ±Ø¯", letters: ['Ùˆ', 'Ø±', 'Ø¯'], shaped: ['Ùˆ', 'Ø±', 'Ø¯'],soundIndex: 27 },
        { word: "ØªÙˆØª", letters: ['Øª', 'Ùˆ', 'Øª'], shaped: ['ØªÙ€', 'Ùˆ',  'Øª'],soundIndex: 28 },
        { word: "ÙÙ„ÙÙ„", letters: ['Ù', 'Ù„', 'Ù', 'Ù„'], shaped: ['ÙÙ€', 'Ù„Ù€', 'ÙÙ€', 'Ù„'],soundIndex: 29 },
        { word: "Ø¯ÙŠÙƒ", letters: ['Ø¯', 'ÙŠ', 'Ùƒ'], shaped: ['Ø¯', 'ÙŠÙ€', 'Ùƒ'],soundIndex: 30 }
      ]
    };

    const arabicLetters = ['Ø£','Ø§','Ø¨','Øª','Ø«','Ø¬','Ø­','Ø®','Ø¯','Ø°','Ø±','Ø²','Ø³','Ø´','Øµ','Ø¶','Ø·','Ø¸','Ø¹','Øº','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ù‡Ù€','Ø©','Ùˆ','ÙŠ'];

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù…Ù† sessionStorage ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù„Ø±Ù‚Ù…
    const levelMap = { 'A': 1, 'B': 2, 'C': 3 };
    const selectedLevel = sessionStorage.getItem('selectedLevel') || 'A';
    const currentLevel = levelMap[selectedLevel];

    let words = [...levelsWords[currentLevel]];
    let wordQueue = [];

    let currentWord = {}, placedLetters = [], correctAnswers = 0;
    let demoTrialCount = 0; // Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª ÙÙŠ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
    const maxTrials = 3; // Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© ÙÙŠ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ

    const starElems = [];
    const initialStarSrc = ['images/star1.png','images/star2.png','images/star3.png'];
    const highlightStarSrc = 'images/star_red.png';

    let dropAreaEl = null;

    function playSoundSafe(src) { try { new Audio(src).play().catch(() => {}); } catch(e) {} }

    function shuffleArray(array){
      for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
      }
      return array;
    }

    function setupWordQueue(){
      wordQueue = shuffleArray([...words]);
    }

    function setupNewWord() {
      if(wordQueue.length===0) setupWordQueue();

      currentWord = wordQueue.pop();
      placedLetters = [];
      document.getElementById('wordDisplay').textContent = currentWord.word;
      dropAreaEl.textContent = '';

      const grid = document.getElementById('lettersGrid');
      grid.innerHTML = '';

      arabicLetters.forEach(letter => {
        const div = document.createElement('div');
        div.className = 'letter';
        div.textContent = letter;
        div.draggable = true;
        div.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', letter));
        grid.appendChild(div);
      });
    }

    function handleDrop(e){
      e.preventDefault();
      const droppedLetter = e.dataTransfer.getData('text/plain');
      if(!droppedLetter) return;
      const expectedLetter = currentWord.letters[placedLetters.length];

      if(droppedLetter === expectedLetter){
        placedLetters.push(droppedLetter);
        const shapedLetters = currentWord.shaped.slice(0, placedLetters.length);
        dropAreaEl.innerHTML = '';
        shapedLetters.forEach(letter => {
          const span = document.createElement('span');
          span.textContent = letter;
          span.style.margin='0 5px';
          dropAreaEl.appendChild(span);
        });
        dropAreaEl.classList.add('correct-letter');
        setTimeout(()=>dropAreaEl.classList.remove('correct-letter'),500);
        playSoundSafe('sounds/correct.mp3');

        if(placedLetters.length === currentWord.letters.length){
          playSoundSafe(`sounds/word${currentWord.soundIndex}.mp3`);
          dropAreaEl.classList.add('glowing-box');

          demoTrialCount++;
          correctAnswers++;

          updateSidebarStarsByProgress();

          if (demoTrialCount >= maxTrials) {
            setTimeout(() => {
              document.getElementById('demoEndPopup').classList.add('show');
            }, 1500);
          } else {
            setTimeout(()=>{ 
              dropAreaEl.classList.remove('glowing-box'); 
              setupNewWord(); 
            }, 1800);
          }
        }
      } else playSoundSafe('sounds/wrong.mp3');
    }

    function animateStar(starEl){ starEl.style.transform='translateX(15px) scale(1.25)'; setTimeout(()=>starEl.style.transform='',250); }

    function updateSidebarStarsByProgress(){
      const thresholds = [3,6,9];
      thresholds.forEach((t,idx)=>{
        if(correctAnswers>=t && starElems[idx] && !starElems[idx].dataset.activated){
          starElems[idx].src = highlightStarSrc;
          starElems[idx].dataset.activated='1';
          animateStar(starElems[idx]);
        }
      });
    }

    function resetActivity(){
      correctAnswers=0;
      demoTrialCount = 0;
      starElems.forEach((s,i)=>{ s.src=initialStarSrc[i]; delete s.dataset.activated; s.style.transform=''; });
      setupWordQueue();
      setupNewWord();
    }

    document.addEventListener('DOMContentLoaded',()=>{
      dropAreaEl=document.getElementById('analysisArea');
      const homeBtn=document.getElementById('homeBtn');
      const retryBtn=document.getElementById('retryBtn');
      starElems.push(document.getElementById('star1'),document.getElementById('star2'),document.getElementById('star3'));
      if(homeBtn) homeBtn.addEventListener('click',()=>window.location.href='activities_demo.html');
      retryBtn.addEventListener('click',()=>{ clearInterval(timerInterval); timerInterval=null; counter=0; timerDisplay.textContent=counter; resetActivity(); });
      dropAreaEl.addEventListener('dragover',e=>e.preventDefault());
      dropAreaEl.addEventListener('drop',handleDrop);
      setupWordQueue();
      setupNewWord();
    });

    document.addEventListener('contextmenu', e=>e.preventDefault());
    document.querySelector('.instructions-icon').addEventListener('click',()=>{ new Audio('sounds/sd3_sound.mp3').play().catch(e=>{}); });

    let timerInterval, counter=0;
    const timerDisplay=document.getElementById('timer');
    document.getElementById('playBtn').addEventListener('click',()=>{ clearInterval(timerInterval); timerInterval=setInterval(()=>{ counter++; timerDisplay.textContent=counter; },1000); });
    document.getElementById('stopBtn').addEventListener('click',()=>clearInterval(timerInterval));
  </script>
</body>

</html>

