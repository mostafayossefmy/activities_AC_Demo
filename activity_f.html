<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø³Ø§Ø¯Ø³ - Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù†Ø§Ù‚Øµ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @font-face {
            font-family: 'NotoSansArabic_Condensed-Bold';
            src: url('fonts/NotoSansArabic_Condensed-Bold.ttf') format('truetype');
        }

        body {
            margin: 0; padding: 0;
            background: url('images/back_a_img.png') no-repeat center center;
            background-size: cover; height: 100vh;
            display: flex; align-items: center; justify-content: center;
            font-family: 'NotoSansArabic_Condensed-Bold', sans-serif;
            overflow: hidden;
        }

        .activity-container {
            width: 100%; max-width: 1000px; height: 80vh; max-height: 800px;
            background: #ffffff; border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            display: flex; flex-direction: row-reverse;
            align-items: center; justify-content: space-between;
            position: relative;
        }

        .sidebar {
            width: 15%; background: #f3e8ff;
            display: flex; flex-direction: column;
            align-items: center; justify-content: space-around;
            padding: 15px 5px; border-top-right-radius: 15px;
            border-bottom-right-radius: 15px; box-sizing: border-box; height: 100%;
        }

        .stars { direction: rtl; display: flex; align-items: flex-end; justify-content: center; gap: 6px; }
        .stars img { width: 30px; height: 30px; transition: transform .25s ease; }
        .stars img:nth-child(2) { transform: translateY(-6px); }

        .child-photo img { width: 110px; height: 110px; display: block; margin: 0 auto; object-fit: cover; }
        .student-name p {
            margin: 0; font-size: 16px; font-weight: bold; background: #fff1cc;
            border-radius: 12px; padding: 6px 12px; white-space: nowrap;
        }

        .timer-controls {
            display: flex; align-items: center; justify-content: center; gap: 8px; direction: ltr;
        }

        .timer-display {
            font-size: 20px; font-weight: bold; background: #f779e2;
            border-radius: 8px; padding: 5px 10px; min-width: 50px;
            height: 35px; text-align: center; display: flex; align-items: center; justify-content: center;
        }

        .controls { display: flex; gap: 10px; justify-content: center; direction: ltr; }
        .controls img { width: 50px; height: 50px; cursor: pointer; transition: transform 0.15s ease; }
        .controls img:hover { transform: scale(1.08); }

        .content-area {
            width: 85%; display: flex; flex-direction: column;
            align-items: center; justify-content: space-around;
            height: 100%; position: relative;
        }

        .activity-label { position: absolute; top: -25px; left: -25px; width: 150px; z-index: 5; }
        .instructions-icon { position: absolute; top: 35px; left: 25px; width: 70px; height: 70px; cursor: pointer; z-index: 15; }

        .image-box {
            width: 85%; max-width: 220px; height: 220px;
            background: url('images/back_img.png') no-repeat center center;
            background-size: cover; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
        }
        .image-box img { max-width: 180px; max-height: 180px; cursor: pointer; }

        .word-drop-zone {
            display: flex; justify-content: center; align-items: center;
            min-height: 70px; width: 90%; max-width: 400px;
            background: #ffffcc; border: 8px solid #ff9966; border-radius: 10px;
            font-size: 45px; font-weight: bold; direction: rtl; color: #1505ee;
        }

        .missing-letter { color: red; font-weight: bold; min-width: 30px; text-align: center; }

        .letters-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; max-width: 635px; direction: rtl; }

        .letter {
            width: 50px; height: 50px;
            background: url('images/back_letter.png') no-repeat center center;
            background-size: cover; display: flex; align-items: center;
            justify-content: center; font-size: 30px; color: white; cursor: grab;
        }

        .glowing-box { animation: correctGlow 1.5s ease-in-out 3; }
        @keyframes correctGlow {
            0%, 100% { box-shadow: 0 0 0 #4CAF50; }
            50% { box-shadow: 0 0 30px 10px #4CAF50; }
        }

        .difficulty-options {
            position: absolute; top: 10px; right: 10px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .difficulty-options img { width: 35px; height: 35px; cursor: pointer; transition: 0.2s; }
        .difficulty-options img.active { 
            transform: scale(1.1); 
            filter: brightness(1.1);
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙÙŠ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ */
        .demo-end-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 200;
        }

        .demo-end-popup.show {
            visibility: visible;
            opacity: 1;
        }

        .demo-end-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            animation: popIn 0.6s ease;
        }

        .demo-end-content h2 {
            font-size: 2.5rem;
            color: #1dd1a1;
            margin-bottom: 20px;
        }

        .demo-end-content p {
            font-size: 1.8rem;
            color: #333;
            margin: 20px 0;
        }

        .demo-end-content .close-btn {
            background: #ff6b6b;
            color: white;
            padding: 15px 50px;
            border-radius: 50px;
            font-size: 1.6rem;
            cursor: pointer;
            margin-top: 30px;
            display: inline-block;
        }

        .demo-end-content .close-btn:hover {
            background: #ee5a24;
        }

        @keyframes popIn {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>

<body>
    <div class="activity-container">
        <div class="sidebar">
            <div class="row stars">
                <img id="star1" src="images/star1.png">
                <img id="star2" src="images/star2.png">
                <img id="star3" src="images/star3.png">
            </div>
            <div class="child-photo"><img id="childPhoto" src="images/child_photo.png"></div>
            <div class="student-name"><p id="studentName">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</p></div>
            <div class="timer"><img src="images/timer.png" style="width:70px;"></div>
            
            <div class="timer-controls">
                <img src="images/stop.png" id="stopBtn" style="width:33px; cursor:pointer;">
                <div class="timer-display" id="timerDisplay">0</div>
                <img src="images/play.png" id="startBtn" style="width:33px; cursor:pointer;">
            </div>

            <div class="row controls">
                <img id="retryBtn" src="images/retry.png">
                <img id="homeBtn" src="images/home.png">
            </div>
        </div>

        <div class="content-area">
            <img src="images/sd_img.png" class="instructions-icon" id="insBtn">
            <img src="images/actv_6.png" class="activity-label">

            <div class="image-box" id="imageBox"></div>
            <div class="word-drop-zone" id="wordDropZone" data-correct-letter="" data-word=""></div>
            <div class="letters-grid" id="lettersGrid"></div>

            <div class="difficulty-options">
                <img src="images/letter_a.png" onclick="setLevel(1)">
                <img src="images/letter_b.png" onclick="setLevel(2)">
                <img src="images/letter_c.png" onclick="setLevel(3)">
            </div>

            <audio id="correctSound" src="sounds/correct.mp3"></audio>
            <audio id="wrongSound" src="sounds/wrong.mp3"></audio>
            <audio id="applauseSound" src="sounds/clap.mp3"></audio>
        </div>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© -->
    <div class="demo-end-popup" id="demoEndPopup">
        <div class="demo-end-content">
            <h2>Ù‡Ø§ÙŠÙ„ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‘</h2>
            <p>Ù…Ù…ÙƒÙ† ØªØ´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† Ø¹Ø´Ø§Ù† ØªÙƒÙ…Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§ØªØŸ</p>
            <p>Ø´ÙƒØ±Ø§ Ù„Ùƒ Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©</p>
            <div class="close-btn" onclick="window.location.href='activities_demo.html'">Ø­Ø³Ù†Ù‹Ø§</div>
        </div>
    </div>

    <script>
        const globalLevel = sessionStorage.getItem('selectedLevel') || 'A';

               // 2. Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„ÙƒØ¨Ø±Ù‰ (90 ÙƒÙ„Ù…Ø©)
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ù…Øª Ø¨ÙˆØ¶Ø¹ Ø§Ù„Ù€ 30 ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ ÙƒÙ…Ø«Ø§Ù„ØŒ Ø¹Ù„ÙŠÙƒ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø·
        const allWordsMatrix = {
            'A': {
                1: [ // ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ A - Ø£ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø©
                    { id: 1, word: "ÙÙŠÙ„", missing: "Ù", shaped: ["ÙÙ€", "ÙŠÙ€", "Ù„"] },
                    { id: 2, word: "Ø£Ø³Ø¯", missing: "Ø£", shaped: ["Ø£", "Ø³Ù€", "Ø¯"] },
                    { id: 3, word: "Ù‚Ù„Ù…", missing: "Ù‚", shaped: ["Ù‚Ù€", "Ù„Ù€", "Ù…"] }

                ],
                2: [ // ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ A - ÙˆØ³Ø· Ø§Ù„ÙƒÙ„Ù…Ø©
                    { id: 11, word: "Ø¨Ù†Øª", missing: "Ù†", shaped: ["Ø¨Ù€", "Ù†Ù€", "Øª"] },
                    { id: 12, word: "ÙƒØªØ§Ø¨", missing: "Øª", shaped: ["ÙƒÙ€", "ØªÙ€", "Ø§", "Ø¨"] },
                    { id: 13, word: "Ø¨ÙŠØª", missing: "ÙŠ", shaped: ["Ø¨Ù€", "ÙŠÙ€", "Øª"] }
                ],
                3: [ // ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ A - Ø¢Ø®Ø± Ø§Ù„ÙƒÙ„Ù…Ø©
                    { id: 21, word: "Ø´Ø§ÙŠ", missing: "ÙŠ", shaped: ["Ø´Ù€", "Ø§", "ÙŠ"] },
                    { id: 22, word: "Ø®Ø³", missing: "Ø³", shaped: ["Ø®Ù€", "Ø³"] },
                    { id: 23, word: "Ø­ØµØ§Ù†", missing: "Ù†", shaped: ["Ø­Ù€", "ØµÙ€", "Ø§", "Ù†"] }
                ]
            },
            'B': {
                1: [ /* Ø£Ø¶Ù Ù‡Ù†Ø§ 10 ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ B Ø¨Ø¯Ø§ÙŠØ© */ 
                    { id: 4, word: "Ø´Ù…Ø³", missing: "Ø´", shaped: ["Ø´Ù€", "Ù…Ù€", "Ø³"] },
                    { id: 5, word: "Ù†Ù…Ø±", missing: "Ù†", shaped: ["Ù†Ù€", "Ù…Ù€", "Ø±"] },
                    { id: 6, word: "Ø¯ÙŠÙƒ", missing: "Ø¯", shaped: ["Ø¯", "ÙŠÙ€", "Ùƒ"] }
                ],
                2: [ /* Ø£Ø¶Ù Ù‡Ù†Ø§ 10 ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ B ÙˆØ³Ø· */
                    { id: 17, word: "ØªÙØ§Ø­", missing: "Ù", shaped: ["ØªÙ€", "ÙÙ€", "Ø§", "Ø­"] },
                    { id: 18, word: "Ù…ÙˆØ²", missing: "Ùˆ", shaped: ["Ù…Ù€", "Ùˆ", "Ø²"] },
                    { id: 19, word: "Ø¯Ø¨", missing: "Ø¨", shaped: ["Ø¯", "Ø¨"] },
                    { id: 20, word: "Ø±Ù…Ø§Ù†", missing: "Ù…", shaped: ["Ø±", "Ù…Ù€", "Ø§", "Ù†"] }
                 ],
                3: [ /* Ø£Ø¶Ù Ù‡Ù†Ø§ 10 ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ B Ù†Ù‡Ø§ÙŠØ© */ 
                    { id: 27, word: "Ø¬Ù…Ù„", missing: "Ù„", shaped: ["Ø¬Ù€", "Ù…Ù€", "Ù„"] },
                    { id: 28, word: "Ù„Ø­Ù…", missing: "Ù…", shaped: ["Ù„Ù€", "Ø­Ù€", "Ù…"] },
                    { id: 29, word: "Ø­ÙˆØª", missing: "Øª", shaped: ["Ø­Ù€", "Ùˆ", "Øª"] },
                    { id: 30, word: "Ø®Ø±ÙˆÙ", missing: "Ù", shaped: ["Ø®Ù€", "Ø±", "Ùˆ", "Ù"] }
                ]
            },
            'C': {
                1: [ /* Ø£Ø¶Ù Ù‡Ù†Ø§ 10 ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ C Ø¨Ø¯Ø§ÙŠØ© */
                    { id: 7, word: "ÙÙˆÙ„", missing: "Ù", shaped: ["ÙÙ€", "Ùˆ", "Ù„"] },
                    { id: 8, word: "Ù‚Ù…Ø±", missing: "Ù‚", shaped: ["Ù‚Ù€", "Ù…Ù€", "Ø±"] },
                    { id: 9, word: "Ù‚Ø±Ø¯", missing: "Ù‚", shaped: ["Ù‚Ù€", "Ø±", "Ø¯"] },
                    { id: 10, word: "Ù†Ø¬Ù…", missing: "Ù†", shaped: ["Ù†Ù€", "Ø¬Ù€", "Ù…"] }
                 ],
                2: [ /* Ø£Ø¶Ù Ù‡Ù†Ø§ 10 ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ C ÙˆØ³Ø· */
                    { id: 14, word: "ÙˆÙ„Ø¯", missing: "Ù„", shaped: ["Ùˆ", "Ù„Ù€", "Ø¯"] },
                    { id: 15, word: "Ø¹Ù†Ø¨", missing: "Ù†", shaped: ["Ø¹Ù€", "Ù†Ù€", "Ø¨"] },
                    { id: 16, word: "Ø¬Ø²Ø±", missing: "Ø²", shaped: ["Ø¬Ù€", "Ø²", "Ø±"] }
                 ],
                3: [ /* Ø£Ø¶Ù Ù‡Ù†Ø§ 10 ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ C Ù†Ù‡Ø§ÙŠØ© */ 
                    { id: 24, word: "Ø¶ÙØ¯Ø¹", missing: "Ø¹", shaped: ["Ø¶Ù€", "ÙÙ€", "Ø¯", "Ø¹"] },
                    { id: 25, word: "Ø¨Ø·ÙŠØ®", missing: "Ø®", shaped: ["Ø¨Ù€", "Ø·Ù€", "ÙŠÙ€", "Ø®"] },
                    { id: 26, word: "ÙƒÙ„Ø¨", missing: "Ø¨", shaped: ["ÙƒÙ€", "Ù„Ù€", "Ø¨"] }
                ]
            }
        };

        let currentSubLevel = 1;
        let correctAnswers = 0;
        let availableWords = [];
        let isWaiting = false;
        let timerInterval;
        let counter = 0;
        let demoTrialCount = 0; // Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª ÙÙŠ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
        const maxTrials = 3;

        function setLevel(sub) {
            currentSubLevel = sub;
            document.querySelectorAll('.difficulty-options img').forEach(img => img.classList.remove('active'));
            const activeImg = document.querySelectorAll('.difficulty-options img')[sub-1];
            if (activeImg) activeImg.classList.add('active');

            correctAnswers = 0;
            demoTrialCount = 0;
            resetStars();
            resetTimer();

            const words = allWordsMatrix[globalLevel][sub];
            if(words && words.length > 0) {
                availableWords = [...words].sort(() => Math.random() - 0.5);
                startNewRound();
            }
        }

        function startNewRound() {
            if (isWaiting) return;
            if (availableWords.length === 0) {
                availableWords = [...allWordsMatrix[globalLevel][currentSubLevel]].sort(() => Math.random() - 0.5);
            }
            const current = availableWords.shift();
            const imageBox = document.getElementById('imageBox');
            imageBox.innerHTML = `<img src="images/word_photo${current.id}.png" onclick="new Audio('sounds/word_photo${current.id}.mp3').play()">`;
            const dropZone = document.getElementById('wordDropZone');
            dropZone.dataset.correctLetter = current.missing;
            dropZone.dataset.word = current.word;
            dropZone.classList.remove('glowing-box');
            dropZone.innerHTML = current.shaped.map(ltr => ltr.includes(current.missing) ? `<span class="missing-letter">Ù€</span>` : ltr).join("");
            setupLetters(current.missing);
        }

        function setupLetters(correct) {
            const grid = document.getElementById('lettersGrid');
            grid.innerHTML = '';
            const allLetters = "Ø£Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡Ù€ÙˆÙŠ".split("");
            let options = new Set([correct]);
            while (options.size < 10) options.add(allLetters[Math.floor(Math.random() * allLetters.length)]);
            [...options].sort(() => Math.random() - 0.5).forEach(ltr => {
                const div = document.createElement('div');
                div.className = 'letter';
                div.textContent = ltr;
                div.draggable = true;
                div.id = `draggable-${ltr}`;
                div.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', ltr));
                grid.appendChild(div);
            });
        }

        const dropZone = document.getElementById('wordDropZone');
        dropZone.addEventListener('dragover', e => e.preventDefault());
        dropZone.addEventListener('drop', e => {
            e.preventDefault();
            if (isWaiting) return;
            const dropped = e.dataTransfer.getData('text/plain');
            const correct = dropZone.dataset.correctLetter;
            if (dropped === correct) {
                document.getElementById('correctSound').play();
                document.getElementById('applauseSound').play();
                correctAnswers++;
                demoTrialCount++;
                updateStars();
                dropZone.textContent = dropZone.dataset.word;
                dropZone.classList.add('glowing-box');
                isWaiting = true;

                if (demoTrialCount >= maxTrials) {
                    setTimeout(() => {
                        document.getElementById('demoEndPopup').classList.add('show');
                    }, 1500);
                } else {
                    setTimeout(() => { isWaiting = false; startNewRound(); }, 2000);
                }
            } else {
                document.getElementById('wrongSound').play();
            }
        });

        function updateStars() {
            if (correctAnswers === 3) setStar('star1');
            if (correctAnswers === 6) setStar('star2');
            if (correctAnswers === 9) setStar('star3');
        }

        function setStar(id) {
            const star = document.getElementById(id);
            star.src = "images/star_red.png";
            star.style.transform = 'translateX(15px) scale(1.25)';
            setTimeout(() => star.style.transform = '', 250);
        }

        function resetStars() { ['star1', 'star2', 'star3'].forEach(id => document.getElementById(id).src = "images/star1.png"); }
        
        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            counter = 0;
            document.getElementById('timerDisplay').textContent = "0";
        }

        document.getElementById('startBtn').onclick = () => {
            if (!timerInterval) {
                timerInterval = setInterval(() => {
                    counter++;
                    document.getElementById('timerDisplay').textContent = counter;
                }, 1000);
            }
        };
        document.getElementById('stopBtn').onclick = () => { clearInterval(timerInterval); timerInterval = null; };
        document.getElementById('retryBtn').onclick = () => setLevel(currentSubLevel);
        document.getElementById('homeBtn').onclick = () => window.location.href = "activities_demo.html";
        document.getElementById('insBtn').onclick = () => new Audio('sounds/sd6_sound.mp3').play();

        window.onload = () => {
            const storedName = sessionStorage.getItem('userName');
            const storedImage = sessionStorage.getItem('userImage');
            if (storedName) document.getElementById('studentName').textContent = storedName;
            if (storedImage) document.getElementById('childPhoto').src = storedImage;
            setLevel(1);
        };
    </script>
</body>

</html>